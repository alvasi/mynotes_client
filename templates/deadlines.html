<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Deadlines</title>
    <style>
        /* Simple CSS for demonstration */
        body { font-family: Arial, sans-serif; }
        #add-deadline-form { display: none; margin-top: 20px; }
        #deadlines-list { list-style-type: none; padding: 0; }
        #deadlines-list li { margin: 5px 0; }
        input[type=text], input[type=date] { margin: 5px 0; }
    </style>
</head>
<body>
    <h1>Deadlines for <span id="username-display">User</span></h1>

    <!-- Search Filter -->
    <input type="text" id="filter" onkeyup="filterTasks()" placeholder="Filter tasks...">

    <!-- Buttons for filtering deadlines -->
    <button onclick="loadDeadlines('current')">Current</button>
    <button onclick="loadDeadlines('past')">Past</button>
    <button onclick="loadDeadlines('all')">All</button>

    <!-- The Add Deadline Form -->
    <button onclick="toggleAddForm()">Add Deadline</button>
    <div id="add-deadline-form">
        <input type="text" id="task" placeholder="Task Name" required>
        <input type="date" id="deadline-date" required>
        <button onclick="addDeadline()">Save Deadline</button>
    </div>

    <!-- List of Deadlines -->
    <ul id="deadlines-list"></ul>

    <script>
        const API_BASE_URL = 'http://deadline-api-server.c7f8dwe8dbfhhfcx.uksouth.azurecontainer.io:5000';

        document.getElementById('username-display').textContent = sessionStorage.getItem('username') || 'default_user';

        function toggleAddForm() {
            var form = document.getElementById('add-deadline-form');
            form.style.display = form.style.display === 'none' ? 'block' : 'none';
        }

        function addDeadline() {
            var task = document.getElementById('task').value;
            var deadline = document.getElementById('deadline-date').value;
            var username = sessionStorage.getItem('username') || 'default_user';

            // AJAX POST to API
            fetch(`${API_BASE_URL}/add_deadline`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ username, task, deadline })
            })
            .then(response => response.json())
            .then(data => {
                console.log(data);
                loadDeadlines('all'); // Refresh the list
            })
            .catch((error) => {
                console.error('Error:', error);
            });
        }

        function loadDeadlines(filter) {
            var username = sessionStorage.getItem('username') || 'default_user';
            var endpoint = filter === 'all' ? 'all_deadlines' :
                           filter === 'current' ? 'current_deadlines' : 'past_deadlines';

            fetch(`${API_BASE_URL}/${endpoint}?username=${username}`)
            .then(response => response.json())
            .then(data => {
                var list = document.getElementById('deadlines-list');
                list.innerHTML = ''; // Clear current list
                data.entries.forEach(deadline => {
                    var li = document.createElement('li');
                    li.textContent = `${deadline.task} - ${deadline.date} - Completed: ${deadline.completed}`;
                    list.appendChild(li);
                });
            })
            .catch((error) => {
                console.error('Error:', error);
            });
        }

        function filterTasks() {
            var input, filter, ul, li, i, txtValue;
            input = document.getElementById('filter');
            filter = input.value.toUpperCase();
            ul = document.getElementById("deadlines-list");
            li = ul.getElementsByTagName('li');

            for (i = 0; i < li.length; i++) {
                txtValue = li[i].textContent || li[i].innerText;
                if (txtValue.toUpperCase().indexOf(filter) > -1) {
                    li[i].style.display = "";
                } else {
                    li[i].style.display = "none";
                }
            }
        }

        // Initially load all deadlines
        loadDeadlines('all');
    </script>
</body>
</html>
